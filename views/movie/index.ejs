<div class="container-fluid main-content">
  <div class="left-panel col-md-2">
    <!-- ko if: is_showing_movies -->
    <div class="section-nav">
      <ul class="row">
        <li><a class="btn btn-default browse-btn" href="#movies/browse" data-bind="css: {'active': which_movies() == 'browse' }">Browse</a></li>
        <li><a class="btn btn-default recommend-btn" href="#movies/recommended" data-bind="css: {'active': which_movies() == 'recommended' }">Recommended For You</a></li>
        <li>
          <a class="btn btn-default search-btn" href="#movies/search" data-bind="css: {'active': which_movies() == 'search' }">Search</a>
          <div class="row search-row hide-behind">
            <div class="panel panel-default expand-panel">
              <div id="searchOptions" class="panel-collapse collapse">
                <div class="panel-body">
                  <div class="input-group">
                    <input type="text" data-bind="value: search_query, valueUpdate: 'afterkeydown', event: {keypress: searchOnEnter }" placeholder="search by title" class="form-control">
                    <span class="input-group-btn">
                      <button class="btn btn-default" data-bind="click: search" type="button"><span class="glyphicon glyphicon-search"></span></button>
                    </span>
                  </div><br/>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                          year
                      </h4>
                    </div>
                    <div id="yearList" class="panel-collapse collapse in">
                      <div class="panel-body">
                        <select multiple="false" data-bind="options: years, value: selected_year, optionsCaption: 'any year'"></select>
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                          genre
                      </h4>
                    </div>
                    <div id="genreList" class="panel-collapse collapse in">
                      <div class="panel-body">
                        <select data-bind="options: genres, optionsText: 'name', selectedOptions: selected_genres, optionsCaption: 'any genre'" multiple="true"></select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="clear-button-container">
                  <button class="btn btn-warn" data-bind="click: clearSearch">clear</button>
                </div>
              </div>
          </div> <!-- search options panel -->
        </div>
        </li>
      </ul>

    </div> <!-- section nav -->
  <!-- /ko -->

  <!-- ko if: is_showing_lists -->
  <div class="section-nav">
    <ul class="row" data-bind="foreach: movie_lists">
      <li>
        <a class="btn btn-default" data-bind="css: {'active': $parent.selected_list() && $parent.selected_list().id() == id() }, html: name_and_length(), attr: {'href': '#lists/' + id() }"></a>
      </li>
    </ul>
  </div>
  <!-- /ko -->

  <!-- ko if: is_showing_people -->
  <div class="section-nav" data-bind="with: user">
    <ul class="row">
      <li>
        <a class="btn btn-default" data-bind="css: {'active': which_people() == 'matches' }" href="#people/matches">My Matches</a>
        <div class="row matches-row hide-behind">
          <div class="expand-panel">
            <div id="peopleMatches" class="panel-collapse collapse">
              <div class="panel-body">
                <ul data-bind="foreach: matches">
                  <li data-bind="template: {name: 'people-menu-item' }"></li>
                </ul>
              </div>
            </div> <!-- /match list panel -->
          </div>
        </div>
      </li>
      <li>
        <a class="btn btn-default" data-bind="css: {'active': which_people() == 'friends' }" href="#people/friends">My friends</a>
        <div class="row friends-row hide-behind">
          <div class="expand-panel">
            <div id="peopleFriends" class="panel-collapse collapse">
              <div class="panel-body">
                <ul data-bind="foreach: friends">
                  <li data-bind="template: {name: 'people-menu-item' }"></li>
                </ul>
              </div>
            </div> <!-- /friend list panel -->
          </div>
        </div>
      </li>
      <li><a class="btn btn-default" href="#people/invite">Invite Friends</a></li>
    </ul>
  </div>
  <!-- /ko -->

  <footer class="pull-left">
    <hr>
    powered by the <a href="http://www.themoviedb.org" target="_blank">TMDb</a> API
    <br/>
    <div>&copy; Zeele Inc., 2014</div>
    <br/>
    <a data-bind="click: function(){ $('#privacyModal').modal(); }">Privacy Policy</a>
  </footer>
</div> <!-- left panel -->

<!-- right panel section -->

  <div class="right-panel col-md-10">
    <!-- ko if: is_showing_movies -->
    <div class="movie-table-header">
      <div class="search-title-container container-fluid">
        <div class="movie-list-label col-sm-6" data-bind="text: search_title"></div>
        <div class="movie-count col-sm-5" data-bind="text: movie_count_text"></div>
      </div>
    </div>
    <div class="movie-table-container" data-bind="template: {name: 'movie-template', foreach: movies}, event: {scroll: scrolled}"></div>
    <!-- /ko --> <!-- /movies section -->

    <!-- people section -->
    <div class="people-container" data-bind="visible: is_showing_people, with: user">
      <!-- ko if: showing_user_profile -->
        <div data-bind="template: { name: 'person-profile-template', data: parent().selected_user }"></div>
      <!-- /ko -->
    </div>
    <!-- /people section -->

    <!-- movie list section -->
    <div class="movie-list-content" data-bind="visible: is_showing_lists, with: selected_list" >
      <div class="movie-list-header container" data-bind="visible: id()">
        <div class="row" data-bind="visible: is_public() || is_owner()">
          <div class="col-sm-6">
            <span class="movie-list-title" data-bind="html: name"></span>
          </div>
          <div class="col-sm-2">
            <!-- ko if: is_owner() -->
            <h4>public: <input type="checkbox" data-bind="checked: is_public" /></h4>
            <!-- /ko -->
          </div>
          <div class="col-sm-2 sm-links">
            <div class="social-button"><span class="fa fa-2x fa-facebook-square" data-bind="click: $parent.shareOnFacebook"></span></div>
            <div class="social-button"><a data-bind="attr: {href: twitterLink }" target="_blank"><span class="fa fa-2x fa-twitter-square"></span></a></div>
            <div class="social-button"><span class="fa fa-2x fa-reddit-square"></span></div>
          </div>
          <div class="col-sm-2" style="text-align:left">
            <div class="delete-list-button pointer" data-bind="click: $parent.deleteList">
              <span class="fa fa-2x fa-times-circle"></span>
            </div>
          </div>
        </div>
      </div>
      <!-- ko if: is_public() || is_owner() -->
      <div class="movie-list-container" data-bind="template: {name: 'list-movie-template', foreach: movies}"></div>
      <!-- /ko -->
      <div class="row" data-bind="visible: !is_public() && !is_owner() && name()">
        <div class="container col-sm-12">
          <div style="width:100%;text-align:center"><h3>This list is private.</h3></div>
        </div>
      </div>
      <div class="row" data-bind="visible: parent().movie_lists().length == 0 && !parent().getting_lists()">
        <div class="container col-sm-12">
          <div style="width:100%;text-align:center"><h3>You haven't created any lists yet.</h3></div>
        </div>
      </div>
    </div>
    <!-- /movie list section -->

  </div> <!-- right panel -->
</div> <!-- main content -->

<div id="reviewsModal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="reviewsModalLabel" aria-hidden="true" data-bind="with: selected_movie">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 id="reviewsModalLabel" class="modal-title" data-bind="text: reviewsModalTitle">Movie Reviews</h4>
      </div>
      <div class="modal-body">
        <!-- ko if: !current_user_has_reviewed() && parent().user().authenticated() -->
        <textarea data-bind="value: new_review_text" placeholder="write a review..."></textarea>
        <button class="btn btn-default" data-bind="click: saveReview">submit</button>
        <hr/>
        <!-- /ko  -->

        <!-- ko if: !parent().user().authenticated() -->
        <div class="sign-in-message-container"><h4><a href="#" data-bind="click: parent().user().login">Sign in</a> to post a review</h4></div>
        <!-- /ko -->

        <ul data-bind="foreach: reviews" class="row">
          <div class="row list-review-row">
            <div class="col-sm-2">
              <div class="reviewer-image-container"><img data-bind="attr: {src: reviewer_picture_url }" /></div>
              <div class="reviewer-name-container"><span data-bind="text: reviewer_name"></span></div>
            </div>
            <div class="col-sm-9">
              <div class="reviewer-rating-container"><div style="float:left"><span data-bind="text: reviewer_name"></span>'s rating: </div>
                <div class="rating-star-container" data-bind="template: {name: 'average-rating-template'}"></div>
                <!-- ko if: is_owner -->
                <div class="delete-review-button">
                  ( <a href="#" data-bind="click: $parent.deleteReview">delete review</span></a> )
                </div>
                <!-- /ko -->
              </div>
              <div class="movie-review-container">
                <div class="created-date" data-bind="text: created_date"></div>
                "<span data-bind="html: content"></span>"
              </div>
            </div>
            <div class="col-sm-1" style="margin-top:10px;">
              <div class="review-vote">
                <span class="fa fa-lg" data-bind="css: thumb_up_style, click: voteUp"></span>
              </div>
              <div class="fa fa-stack">
                <span class="fa fa-stack-2x fa-circle-thin"></span>
                <span class="fa fa-stack-1x review-score " data-bind="text: review_score"></span>
              </div>
              <div class="review-vote">
                <span class="fa fa-lg fa-flip-horizontal" data-bind="css: thumb_down_style, click: voteDown"></span>
              </div>
            </div>
          </div>
        </ul>
      </div>
    </div>
  </div>
</div>

<script type="text/html" id="current-rating-template">
  <div class="pointer" data-bind="event: {'mouseout': resetRatingClasses }">
    <div class="star-rating fa-stack" data-bind="style: {opacity: temp_rating() ? '1' : '.5'}, event: {'mousemove': updateRatingClass }, click: function(vm, event){setRating(1, event)}">
      <span class="fa fa-stack-2x fa-star-o"></span>
      <span class="fa fa-stack-2x top-star-stack" star="1" data-bind="css: ratingClass(1)"></span>
    </div>
    <div class="star-rating fa-stack" data-bind="style: {opacity: temp_rating() ? '1' : '.5'}, event: {'mousemove': updateRatingClass }, click: function(vm, event){setRating(2, event)}">
      <span class="fa fa-stack-2x fa-star-o"></span>
      <span class="fa fa-stack-2x top-star-stack" star="2" data-bind="css: ratingClass(2)"></span>
    </div>
    <div class="star-rating fa-stack" data-bind="style: {opacity: temp_rating() ? '1' : '.5'}, event: {'mousemove': updateRatingClass }, click: function(vm, event){setRating(3, event)}">
      <span class="fa fa-stack-2x fa-star-o"></span>
      <span class="fa fa-stack-2x top-star-stack" star="3" data-bind="css: ratingClass(3)"></span>
    </div>
    <div class="star-rating fa-stack" data-bind="style: {opacity: temp_rating() ? '1' : '.5'}, event: {'mousemove': updateRatingClass }, click: function(vm, event){setRating(4, event)}">
      <span class="fa fa-stack-2x fa-star-o"></span>
      <span class="fa fa-stack-2x top-star-stack" star="4" data-bind="css: ratingClass(4)"></span>
    </div>
    <div class="star-rating fa-stack" data-bind="style: {opacity: temp_rating() ? '1' : '.5'}, event: {'mousemove': updateRatingClass }, click: function(vm, event){setRating(5, event)}">
      <span class="fa fa-stack-2x fa-star-o"></span>
      <span class="fa fa-stack-2x top-star-stack" star="5" data-bind="css: ratingClass(5)"></span>
    </div>
  </div>
</script>

<script type="text/html" id="average-rating-template">
    <span class="fa" data-bind="css: average_star_css(2)"></span>
    <span class="fa" data-bind="css: average_star_css(4)"></span>
    <span class="fa" data-bind="css: average_star_css(6)"></span>
    <span class="fa" data-bind="css: average_star_css(8)"></span>
    <span class="fa" data-bind="css: average_star_css(10)"></span>
</script>

<script type="text/html" id="list-movie-template">
  <div class="row list-movie-row">
    <div class="col-sm-1 pointer" data-bind="click: showDetails">
      <img class="list-movie-image" data-bind="attr: {src: image_url}" />
    </div>
    <div class="col-sm-4 pointer">
      <h4 data-bind="click: showDetails, text: title_and_year"></h4>
      <a data-bind="attr: {href: amazon_link }" target="_blank">
        <img class="amazon-button-small amazon-list-item-button" src="/img/amazon.png" alt="find on amazon" />
      </a>
    </div>
    <div class="col-sm-3">your rating: <div data-bind="template: {name: 'current-rating-template'}"></div></div>
    <div class="col-sm-4" style="text-align:right">
      <div class="delete-list-item-button pointer" data-bind="click: $parent.removeMovie">
        <span class="fa fa-lg fa-times-circle"></span>
      </div>
    </div>
  </div>
</script>

<script type="text/html" id="list-friend-template">
  <div class="row list-person-row">
    <div class="col-sm-2">
      <a data-bind="attr:{ href: fb_profile_url }" target="_blank"><img class="list-person-image" data-bind="attr: {src: profile_pic_url}" /></a>
    </div>
    <div class="col-sm-5 pointer">
      <h4 data-bind="text: name"></h4>
    </div>
      <!-- ko if: match_score() > 0 -->
      <div class="progress match-progress">
        <div class="progress-bar progress-bar-success" role="progressbar" data-bind="attr:{ 'area-valuenow': match_score() * 100 }, style: {width: (match_score() * 100) + '%'}" aria-valuemin="0" aria-valuemax="100">
          <span data-bind="text: (match_score() * 100) + '% match'"></span>
        </div>
      </div>
      <!-- /ko -->
      <!-- ko if: match_score() <= 0 -->
        <div class="too-few"><span data-toggle="tooltip" data-placement="bottom" title="Too few rated movies in common">(Match Score Unknown)</span></div>
      <!-- /ko -->
    </div>
  </div>
</script>

<script type="text/html" id="cast-member-template">
  <div class="cast-member-container container">
    <span data-bind="text: name"></span><br/>
    <img data-bind="attr: {src: image_url}" /><br/>
  <div class="character-container" data-bind="text: character"></div>
</script>

<script type="text/html" id="people-menu-item">
  <div class="person-menu-item container-fluid" data-bind="click: viewUserProfile">
    <div class="pic-name-row row">
      <div class="col-xs-2">
        <img data-bind="attr: {src: profile_pic_url_small}" />
      </div>
      <div class="col-xs-10">
        <span class="list-person-name" data-bind="text: name"></span>
        <div class="progress match-menu-progress">
          <div class="progress-bar progress-bar-success" role="progressbar" data-bind="attr:{ 'area-valuenow': match_percent }, style: {width: match_percent() + '%'}" aria-valuemin="0" aria-valuemax="100">
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/javascript">
  $(function(){
    var vm = new MoviesViewModel();
    processLogin = vm.user().processLogin;
    ko.applyBindings(vm);
  });

function processLogin(){};

function logIn(){}
</script>

<% include feedback.ejs %>

<% include userProfile.ejs %>

<% include movieTemplate.ejs %>

<% include personDetails.ejs %>

<% include addToList.ejs %>

<% include movieDetails.ejs %>

<% include privacyModal.ejs %>
